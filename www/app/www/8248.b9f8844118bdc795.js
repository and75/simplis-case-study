"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8248],{8248:(j,_,l)=>{l.r(_),l.d(_,{SubscribeModule:()=>D});var p=l(6814),a=l(5548),c=l(95),v=l(553),d=l(9862),x=l(2096),P=l(8645);const C={now:()=>(C.delegate||Date).now(),delegate:void 0};class O extends P.x{constructor(r=1/0,t=1/0,i=C){super(),this._bufferSize=r,this._windowTime=t,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,r),this._windowTime=Math.max(1,t)}next(r){const{isStopped:t,_buffer:i,_infiniteTimeWindow:o,_timestampProvider:s,_windowTime:u}=this;t||(i.push(r),!o&&i.push(s.now()+u)),this._trimBuffer(),super.next(r)}_subscribe(r){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(r),{_infiniteTimeWindow:i,_buffer:o}=this,s=o.slice();for(let u=0;u<s.length&&!r.closed;u+=i?1:2)r.next(s[u]);return this._checkFinalizedStatuses(r),t}_trimBuffer(){const{_bufferSize:r,_timestampProvider:t,_buffer:i,_infiniteTimeWindow:o}=this,s=(o?1:2)*r;if(r<1/0&&s<i.length&&i.splice(0,i.length-s),!o){const u=t.now();let h=0;for(let f=1;f<i.length&&i[f]<=u;f+=2)h=f;h&&i.splice(0,h+1)}}}var y=l(3020),m=l(9397),b=l(6306),e=l(2029),w=l(6466);let S=(()=>{class n{constructor(t,i){this.http=t,this.authService=i,this.ApiServiceUrl=`${v.N.apiUrl}`}get Header(){return new d.WM}getActivities(){return this.http.get(`${this.ApiServiceUrl}activities`,{headers:this.Header}).pipe((0,m.b)(i=>this.log("fetched getActivities (all)")),(0,b.K)(this.handleError("getActivities (all)",[])))}searchActivities(t){return t.trim()?this.http.get(`${this.ApiServiceUrl}activities/search?q=${t}`,{headers:this.Header}).pipe((0,m.b)(o=>this.log(`fetched AppSearch matching "${t}"`)),(0,b.K)(this.handleError("AppSearch",[]))):(0,x.of)([])}saveSubscription(t){const i=`${this.ApiServiceUrl}subscription/save`,o=new FormData;return o.append("subscription",JSON.stringify(t)),this.http.post(i,o,{headers:this.Header}).pipe((0,m.b)(s=>this.log("fetched saveSubscription")),(0,b.K)(this.handleError("saveSubscription",[])))}downloadPDF(t){return this.http.get(`${v.N.apiUrl}agreements/pdf?id=${t}`,{headers:this.Header,responseType:"blob",reportProgress:!0,observe:"events"}).pipe(function T(n,r,t){let i,o=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:r=1/0,refCount:o=!1,scheduler:t}=n):i=null!=n?n:1/0,(0,y.B)({connector:()=>new O(i,r,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}(1),(0,b.K)(this.handleError("downloadPdf")))}handleError(t="operation",i){return o=>(console.error(o),console.log(`${t} failed: ${o.message}`),(0,x.of)(i))}log(t){console.info(t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(d.eN),e.LFG(w.e))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var M=l(5204),g=l(5861);class A{constructor(r){this.currentStep=r.currentStep,this.validStep=r.validStep,this.activity=null==r?void 0:r.activity,this.customer=null==r?void 0:r.customer,this.agreement=null==r?void 0:r.agreement,this.treated=null==r?void 0:r.treated}}function Z(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"li",3),e.NdJ("click",function(){const s=e.CHM(t).index,u=e.oxw(2);return e.KtG(u.setStep(s))}),e.qZA()}2&n&&e.Q6J("ngClass","active"===r.$implicit?"active":"disabled")}function I(n,r){if(1&n&&(e.TgZ(0,"ol",1),e.YNc(1,Z,1,1,"li",2),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.tSteps)}}let J=(()=>{class n{constructor(){this.steps=3,this.current=1,this.stepEvent=new e.vpe,this.tSteps=[]}ngOnInit(){for(let t=0;t<this.steps;t++)this.tSteps.push(this.current-1===t?"active":"disabled")}ngOnChanges(t){for(const o in t){const s=t[o],u=s.currentValue;s.isFirstChange()||this.setStep(u-1)}}setStep(t){const i=t+1;i<=this.current&&(this.tSteps=this.tSteps.map((o,s)=>t<s?"disabled":"active"),this.tSteps[t]="active",this.current=i,this.stepEvent.emit(this.current))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-stepper"]],inputs:{steps:"steps",current:"current"},outputs:{stepEvent:"stepEvent"},features:[e.TTD],decls:1,vars:1,consts:[["class","stepper",4,"ngIf"],[1,"stepper"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"]],template:function(t,i){1&t&&e.YNc(0,I,2,1,"ol",0),2&t&&e.Q6J("ngIf",i.tSteps)},dependencies:[p.mk,p.sg,p.O5],styles:['ol.stepper[_ngcontent-%COMP%]{--default-b: lightgrey;--default-c: black;--active-b: var(--ion-color-primary);--active-c: white;--circle: 2.5em;--b: 5px;display:flex;list-style:none;justify-content:space-between;background:linear-gradient(var(--default-b) 0 0) no-repeat 50% calc((var(--circle) - var(--b)) / 2)/100% var(--b);margin:20px;padding:0;font-size:22px;font-weight:700;counter-reset:step;overflow:hidden}ol.stepper[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:grid;place-items:center;gap:5px;font-family:sans-serif;position:relative}ol.stepper[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:counter(step) " ";counter-increment:step;display:grid;place-content:center;aspect-ratio:1;height:var(--circle);border:5px solid #fff;box-sizing:border-box;background:var(--default-b);color:var(--default-c);border-radius:50%;font-family:monospace;z-index:1}ol.stepper[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]:before{background:var(--active-b);color:var(--active-c)}ol.stepper[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]:after{content:"";position:absolute;height:var(--b);right:100%;top:calc((var(--circle) - var(--b)) / 2);width:100vw;background:var(--active-b)}']}),n})();function E(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"li",16),e.NdJ("click",function(){const s=e.CHM(t).$implicit,u=e.oxw(3);return e.KtG(u.setActivity(s))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit;e.xp6(1),e.Oqu(t.name)}}function N(n,r){if(1&n&&(e.TgZ(0,"ul"),e.YNc(1,E,2,1,"li",15),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.findedActivities)}}function q(n,r){1&n&&(e.TgZ(0,"div",10),e._UZ(1,"ion-spinner",17),e.qZA())}function U(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"form")(1,"fieldset"),e._UZ(2,"div",10),e.TgZ(3,"legend"),e._uU(4,"L'activit\xe9 que vous souhaitez assurer ? "),e.qZA(),e.TgZ(5,"ion-input",11),e.NdJ("ngModelChange",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.query=o)})("keyup",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.filter(o))}),e.qZA(),e.TgZ(6,"div",12)(7,"h5"),e._uU(8),e.qZA(),e.TgZ(9,"div",13),e.YNc(10,N,2,1,"ul",8),e.YNc(11,q,2,0,"div",14),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("clearInput",!0)("ngModel",t.query),e.xp6(3),e.Oqu(t.getAutocompleteLabel()),e.xp6(2),e.Q6J("ngIf",t.findedActivities),e.xp6(1),e.Q6J("ngIf",!t.findedActivities)}}function F(n,r){1&n&&e._UZ(0,"ion-icon",26)}function k(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"form",18),e.NdJ("ngSubmit",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveCustomer())}),e.TgZ(1,"fieldset")(2,"legend"),e._uU(3,"Quelques informations sur votre entreprise !"),e.qZA(),e._UZ(4,"ion-input",19)(5,"ion-input",20)(6,"ion-input",21)(7,"ion-input",22)(8,"ion-input",23),e.qZA(),e.TgZ(9,"ion-button",24),e._uU(10),e.YNc(11,F,1,0,"ion-icon",25),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.formData),e.xp6(4),e.Q6J("clearInput",!0),e.xp6(1),e.Q6J("clearInput",!0),e.xp6(1),e.Q6J("clearInput",!0),e.xp6(1),e.Q6J("clearInput",!0),e.xp6(1),e.Q6J("clearInput",!0),e.xp6(1),e.Q6J("disabled",!t.formData.valid),e.xp6(1),e.hij(" ",t.getStepButtonTitle()," ")}}function L(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"form")(1,"fieldset",27)(2,"legend"),e._uU(3,"Notre offre sur mesure pour vous !"),e.qZA(),e.TgZ(4,"ion-card",28)(5,"ion-card-header")(6,"ion-card-title"),e._uU(7),e.qZA(),e.TgZ(8,"ion-card-subtitle"),e._uU(9),e.qZA()(),e.TgZ(10,"ion-card-content",16),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.downloadPDF())}),e.TgZ(11,"div",29)(12,"div"),e._UZ(13,"ion-icon",30),e.qZA(),e.TgZ(14,"div"),e._uU(15,"T\xe9l\xe9chargez votre devis"),e.qZA()()()()(),e.TgZ(16,"ion-button",31),e._uU(17),e._UZ(18,"ion-icon",26),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(7),e.hij("",t.subscriber.activity.price," \u20ac"),e.xp6(2),e.Oqu(t.subscriber.activity.name),e.xp6(8),e.hij(" ",t.getStepButtonTitle()," ")}}const Q=[{path:"",component:(()=>{class n{constructor(t,i){this.subscriberService=t,this.loadingCtrl=i,this.activities=null,this.findedActivities=null,this.actionSubmitted=!1,this.subscriptions=[],this.query=""}ngOnInit(){this.setSubscriber(),this.setCustomer(),this.setForm(),this.lastActivities()}ngOnDestroy(){this.findedActivities=null,this.cleanSubscriptions()}setCustomer(){this.customer={id:null,raison_sociale:"",siret:"",adresse_postale:"",email:"",telephone:null}}setSubscriber(){this.subscriber=new A({currentStep:1,validStep:0,activity:null,customer:null,agreement:null,treated:!1})}getStepButtonTitle(){return 3==this.subscriber.currentStep?"Je finalise mon achat":"Poursuivre ma souscription "}showLoading(t){var i=this;return(0,g.Z)(function*(){let o=yield i.loadingCtrl.create({message:t});return o.present(),o})()}lastActivities(){this.activities=null,this.subscriberService.getActivities().subscribe(t=>{1==t.status&&(this.activities=t.data,this.findedActivities=this.activities)})}searchActivities(){this.activities=null,this.subscriptions.push(this.subscriberService.searchActivities(this.query).subscribe(t=>{1==t.status&&(this.findedActivities=null,this.findedActivities=t.data)}))}filter(t){this.query.length>=2&&(this.actionSubmitted=!0,this.findedActivities=null,setTimeout(()=>{this.searchActivities()},2e3))}setStep(t){this.subscriber.currentStep=t}setActivity(t){this.subscriber.activity=t,this.query=t.name,setTimeout(()=>{this.subscriber.currentStep=2},2e3)}getAutocompleteLabel(){return this.actionSubmitted&&1==this.subscriber.currentStep?"S\xe9lectionnez une activit\xe9 dans le r\xe9sultat":"Les activit\xe9 le plus recherche"}setForm(){this.formData=new c.cw({raison_sociale:new c.NI(this.customer.raison_sociale,{validators:[c.kI.required]}),siret:new c.NI(this.customer.siret,{validators:[c.kI.required]}),adresse_postale:new c.NI(this.customer.siret,{validators:[c.kI.required]}),email:new c.NI(this.customer.email,{validators:[c.kI.required]}),telephone:new c.NI(this.customer.telephone,{validators:[c.kI.required]})},{updateOn:"blur"})}saveCustomer(){"VALID"==this.formData.status&&(this.actionSubmitted=!0,this.subscriber.customer={...this.subscriber.customer,...this.formData.value},this.saveSubscriber(this.formData.value))}saveSubscriber(t){var i=this;return(0,g.Z)(function*(){i.loading=yield i.showLoading("Nous traitons vos donn\xe9es..."),setTimeout(()=>{i.subscriptions.push(i.subscriberService.saveSubscription(i.subscriber).subscribe(o=>{1==o.status&&(i.loading.spinner=null,i.loading.message="Merci pour votre patience",setTimeout(()=>{i.loading.dismiss().then(()=>{i.subscriber.currentStep=3})},2e3))}))},2e3)})()}downloadPDF(){var t=this;return(0,g.Z)(function*(){t.subscriptions.push(t.subscriberService.downloadPDF("2").subscribe(i=>{switch(console.log(i),i.type){case d.dt.Sent:case d.dt.ResponseHeader:case d.dt.DownloadProgress:break;case d.dt.Response:const o=(window.URL||window.webkitURL).createObjectURL(i.body);window.open(o,"_blank"),setTimeout(()=>{window.URL.revokeObjectURL(o)},9e5)}}))})()}handleRefresh(t){setTimeout(()=>{this.reset(),t.target.complete()},2e3)}cleanSubscriptions(){this.subscriptions.length>0&&this.subscriptions.forEach(t=>t.unsubscribe())}reset(){this.query="",this.setSubscriber(),this.setCustomer(),this.setForm()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(S),e.Y36(a.HT))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-subscribe"]],decls:13,vars:5,consts:[[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"main"],[1,"container"],[1,"box-subscribe"],["src","http://static.bsys3.fr/assets/img/simplis-logo-B100.svg","alt","L'assurance professionnelle des Auto-Entrepreneurs et des Ind\xe9pendants",1,"logo"],["color","secondary",1,"claimer"],[3,"current","stepEvent"],[4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"loader"],["placeholder","Entrez du texte","id","query","name","query","helperText","Rechercher parmi nos profils assurables",3,"clearInput","ngModel","ngModelChange","keyup"],[1,"autocomplete"],[1,"scroller"],["class","loader",4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["name","dots","color","light"],[3,"formGroup","ngSubmit"],["type","text","formControlName","raison_sociale","label","Raison sociale","labelPlacement","floating","helperText","Le nom de votre entreprise","errorText","Ce champ est obligatoire","autocomplete","false","errorText","Ce champ est obligatoire",3,"clearInput"],["type","text","formControlName","siret","label","Siret","labelPlacement","floating","helperText","Votre numero de Siret","errorText","Ce champ est obligatoire","autocomplete","false",3,"clearInput"],["type","text","formControlName","adresse_postale","label","Adresse postale","helperText","L'adresse postale de votre societ\xe8","errorText","Ce champ est obligatoire","labelPlacement","floating","autocomplete","false",3,"clearInput"],["type","email","formControlName","email","label","Email","labelPlacement","floating","autocomplete","off","helperText","L'adresse e-mail avec laquelle nous pouvons vous \xe9crire","errorText","Ce champ est obligatoire",3,"clearInput"],["type","telephone","formControlName","telephone","label","T\xe9l\xe9phone","labelPlacement","floating","autocomplete","false","helperText","Le num\xe9ro de t\xe9l\xe9phone auquel nous pouvons vous joindre","errorText","Ce champ est obligatoire",3,"clearInput"],["S","","type","submit","color","secondary",3,"disabled"],["name","arrow-forward-circle-outline",4,"ngIf"],["name","arrow-forward-circle-outline"],[1,"step3"],["color","secondary"],[1,"downLoad"],["name","download-outline","aria-label","Download devis"],["type","submit","color","secondary"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content",0)(1,"ion-refresher",1),e.NdJ("ionRefresh",function(s){return i.handleRefresh(s)}),e._UZ(2,"ion-refresher-content"),e.qZA(),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4),e._UZ(6,"img",5),e.TgZ(7,"p",6),e._uU(8,'"C\'est parti pour vous assurer au meilleur tarif et en quelques clics !" '),e.qZA(),e.TgZ(9,"app-stepper",7),e.NdJ("stepEvent",function(s){return i.setStep(s)}),e.qZA(),e.YNc(10,U,12,5,"form",8),e.YNc(11,k,12,8,"form",9),e.YNc(12,L,19,3,"form",8),e.qZA()()()()),2&t&&(e.Q6J("fullscreen",!0),e.xp6(9),e.Q6J("current",i.subscriber.currentStep),e.xp6(1),e.Q6J("ngIf",1==i.subscriber.currentStep),e.xp6(1),e.Q6J("ngIf",2==i.subscriber.currentStep),e.xp6(1),e.Q6J("ngIf",3==i.subscriber.currentStep))},dependencies:[p.sg,p.O5,c._Y,c.JJ,c.JL,c.On,c.F,c.sg,c.u,a.YG,a.PM,a.FN,a.Zi,a.tO,a.Dq,a.W2,a.gu,a.pK,a.nJ,a.Wo,a.PQ,a.j9,J],styles:[".main[_ngcontent-%COMP%]{margin:30px 0;padding:0 10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.box-subscribe[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column;max-width:400px}.box-subscribe[_ngcontent-%COMP%]   img.logo[_ngcontent-%COMP%]{width:200px}.box-subscribe[_ngcontent-%COMP%]   .claimer[_ngcontent-%COMP%]{text-align:center;color:var(--ion-color-secondary);font-size:.9rem}.box-subscribe[_ngcontent-%COMP%]   app-stepper[_ngcontent-%COMP%]{width:70%}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:100%;text-align:center;margin-top:1rem}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]{border:thick solid var(--ion-color-primary);border-radius:15px;padding-bottom:2rem}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .autocomplete[_ngcontent-%COMP%], .box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#fff;background:var(--ion-color-primary);font-size:1em;padding:5px 15px;border-radius:10px}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .autocomplete[_ngcontent-%COMP%]{margin:32px -12px -32px;border-top-left-radius:0;border-top-right-radius:0}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .autocomplete[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1rem}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .autocomplete[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]{height:135px;overflow-y:scroll;margin:0 0 20px}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .autocomplete[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .autocomplete[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{flex:auto;padding:10px;font-size:.8rem;cursor:pointer;text-align:left;border-bottom:1px solid #fff}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .autocomplete[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:var(--ion-color-secondary)}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{text-align:left;margin:15px 0}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:20px}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   fieldset.step3[_ngcontent-%COMP%]{background-color:var(--ion-color-secondary)}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   fieldset.step3[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:4rem;font-weight:700}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   fieldset.step3[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;text-transform:uppercase}.box-subscribe[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   fieldset.step3[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:3rem}@media screen and (min-device-width: 1200px){.box-subscribe[_ngcontent-%COMP%]{min-width:500px}}"]}),n})()}];let R=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[M.Bz.forChild(Q),M.Bz]}),n})(),z=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez]}),n})(),D=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[S],imports:[p.ez,c.u5,c.UX,a.Pc,z,R]}),n})()}}]);